FROM registry.redhat.io/openshift4/ose-tools-rhel8@sha256:454d7e4a1b0f9433924440577a29fdfc54b669db4c5b0fd2cb3ae5e640594a68 AS cli-tools
FROM registry.redhat.io/openshift4/ose-cli@sha256:d3a794093896afa185672ad35c03d930bb2ba6ba7ff39ac19ddf71ba2a393ac2 AS ocli
FROM registry.redhat.io/ubi9/python-311@sha256:2b146175c70c878a0cfdd57f5dbb165f2a7d386a57339a71b870b2432eb10513

LABEL description="This image provides a data collection service for segment"
LABEL io.k8s.description="This image provides a data collection service for segment"
LABEL io.k8s.display-name="segment collection"
LABEL io.openshift.tags="segment,segment-collection"
LABEL summary="Provides the segment data collection service"
LABEL com.redhat.component="segment-collection"


USER 0

WORKDIR /opt/app-root/src/

COPY . .
COPY --from=ocli /usr/bin/oc /usr/local/bin/oc
COPY --from=cli-tools /usr/bin/jq /usr/local/bin/jq
COPY --from=cli-tools /usr/lib64/libjq.so.1 /usr/lib64/libjq.so.1
COPY --from=cli-tools /usr/lib64/libonig.so.5 /usr/lib64/libonig.so.5

RUN pip install -U pip && pip install -r /opt/app-root/src/requirements.txt --force-reinstall

USER 1001